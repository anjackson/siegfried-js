<!DOCTYPE html>
<html>
<head>
<script type="text/javascript">window.languagePluginUrl = 'https://pyodide-cdn2.iodide.io/v0.15.0/full/';</script>
<script src="https://pyodide-cdn2.iodide.io/v0.15.0/full/pyodide.js"></script>
</head>
<body>
<input type="file" onchange="doit();" id="file"/>
<div>Output:</div>
<textarea id="output" style="width: 100%;" rows="6" disabled></textarea>
  
      <script type="text/javascript">
      async function main() {
        let pyodide = await loadPyodide();
        await pyodide.loadPackage("micropip");
        await pyodide.runPythonAsync(`
        import micropip
        await micropip.install('https://github.com/anjackson/fido/releases/download/v1.4.1/olefile-0.46-py2.py3-none-any.whl')
        await micropip.install('https://github.com/anjackson/fido/releases/download/v1.4.1/opf_fido-1.4.1-py3-none-any.whl')
      `);
      }
      main();
    </script>

<script type="text/javascript">
var content = null;

function doit() {
    const outputLog = document.getElementById("output");
    outputLog.value += "DOING IT\n";
    var file = document.getElementById("file").files[0];
    var reader = new FileReader();
    reader.readAsBinaryString(file);
    reader.onload = evt => { 
        content = evt.target.result; 
        var output = pyodide.runPython(
`from js import content

print(content[:10])
        
from fido import fido
        
fido.main(['fido'])
        `);
        outputLog.value += output;
      /*
      For downloading the output
        var l = output.length;
        var array = new Uint8Array(l);
        for (var i = 0; i < l; i++) {
            array[i] = output.charCodeAt(i);
        }
        var blob = new Blob([array], {type: 'application/octet-stream'});
        var elem = window.document.createElement('a');
        elem.href = window.URL.createObjectURL(blob);
        elem.download = 'output.pdf';
        document.body.appendChild(elem);
        //elem.click();        
        //document.body.removeChild(elem);
        */
    }
}

languagePluginLoader.then(function () {
    console.log('Ready');
});
</script>
</body>